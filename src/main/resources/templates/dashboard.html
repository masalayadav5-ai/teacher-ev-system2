<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmarTeach | Admin Dashboard</title>
    <link rel="stylesheet" href="/css/dashboard.css">
 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Bootstrap Icons (required for nav icon) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
        <!-- for evaluation icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

 <link rel="stylesheet" href="/css/student.css">
<link rel="stylesheet" href="/css/register_stu.css">

</head>

<body>
    <div class="app">

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="brand">
                <div class="logo">
                    <i class="fa-solid fa-chalkboard-user"></i>
                </div>

    <div class="brand-text">
        <div class="brand-title">SmarTeach</div>
        <div class="brand-admin">Admin</div>
    </div>

    <!-- TOGGLE BUTTON (moved here) -->
    <button class="toggle-btn" onclick="toggleSidebar()">
        <i class="bi bi-list"></i>
    </button>
</div>

            <!-- NAVIGATION -->
            <nav>
                
                
                <ul class="nav flex-column">

                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="loadPage('/pages/dashboard-content.html')">
                            <i class="bi bi-speedometer2"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
<!-- In your sidebar navigation (dashboard.html) -->
<li class="nav-item">
    <a class="nav-link" href="#" onclick="loadPage('/pages/admin-management.html')">
        <i class="fas fa-cogs"></i>
        <span>Academic Management</span>
    </a>
</li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="loadPage('/pages/student.html')">
                            <i class="bi bi-people"></i>
                            <span>Students</span>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="loadPage('/pages/teacher.html')">
                            <i class="bi bi-person-lines-fill"></i>
                            <span>Teachers</span>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="loadPage('/pages/evaldashboard.html')">
                            <i class="bi bi-journal-text"></i>
                            <span>Evaluation</span>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="loadPage('/pages/sessionplan.html')">
                            <i class="bi bi-calendar-week"></i>
                            <span>Session Planner</span>
                        </a>
                    </li>
<li class="nav-item">
                        <a class="nav-link" href="#" onclick="loadPage('/pages/StudentProfile.html')">
                            <i class="bi bi-journal-text"></i>
                            <span>Student Profile</span>
                        </a>
                    </li>
                    <li class="nav-item">
                            <a class="nav-link" id="settingsLink" href="#">
                         <i class="bi bi-gear"></i>
                          <span>Settings</span>
                            </a>
                          </li>
 
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main">

            <!-- Topbar -->
            <div class="topbar">

                <div class="top-title">Welcome!</div>

                <div class="top-actions">
                    <div class="avatar">A</div>
                </div>
            </div>


            <!-- CONTENT AREA -->
 <div id="content-area"></div>
 <link rel="stylesheet" href="css/setting.css">
<!-- Settings Modal Overlay -->
<div class="settings-overlay" id="settingsModal">

    <div class="settings-modal">

        <!-- Modal Header -->
        <div class="settings-header">
            <h2>System Settings</h2>
                        <span class="modal-close">&times;</span>

         </div>

        <!-- Modal Body -->
        <div class="settings-body">

            <!-- Left Menu -->
            <aside class="settings-menu">
                <ul>
                    <li class="active">General</li>
                    <li>Users & Roles</li>
                    <li>Evaluation</li>
                    <li>Session Planner</li>
                    <li>Students</li>
                    <li>Notifications</li>
                    <li>Security</li>
                    <li>System</li>
                </ul>
            </aside>

            <!-- Right Content -->
            <section class="settings-content">

                <!-- General Settings -->
                <div class="settings-section">
                    <h3>General Settings</h3>

                    <div class="form-group">
                        <label>Institution Name</label>
                        <input type="text">
                    </div>

                    <div class="form-group">
                        <label>Academic Year</label>
                        <select>
                            <option>2024 – 2025</option>
                            <option>2025 – 2026</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Time Zone</label>
                        <select>
                            <option>GMT +05:45 (Nepal)</option>
                        </select>
                    </div>
                </div>

            </section>
        </div>

        <!-- Modal Footer -->
        <div class="settings-footer">
             <button class="btn-primary">Save Changes</button>
        </div>

    </div>
</div>

            <div class="footer">
                © 2025 SmarTeach — Teacher Evaluation & Session Planner
            </div>

        </main>

    </div>

    <!-- JS FUNCTIONS -->
 <script>

function loadPage(pageUrl) {
    const area = document.getElementById("content-area");
    area.classList.remove("loaded");

    fetch(pageUrl)
        .then(res => res.ok ? res.text() : "<h3 class='text-danger'>Page Not Found</h3>")
        .then(html => {
            // Remove scripts from loaded pages
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;
            
            // Remove script tags but keep their content
            const scripts = tempDiv.querySelectorAll('script');
            scripts.forEach(script => {
                script.remove();
                // If it's a script with src, we might need to load it
                if (script.src) {
                    console.log('External script found:', script.src);
                }
            });
            
            area.innerHTML = tempDiv.innerHTML;

            requestAnimationFrame(() => {
                area.classList.add("loaded");
            });

            // Handle specific pages
// In your current loadPage function, update the page-specific handlers:

// Handle specific pages
if (pageUrl.includes("sessionplan.html")) {
    // Only try to initialize if we're on the session plan page
    setTimeout(() => {
        if (typeof initSessionPlan === 'function') {
            initSessionPlan();
        } else {
            console.log('initSessionPlan not available on this page');
        }
    }, 100);
}

if (pageUrl.includes("student.html")) {
    setTimeout(() => {
        if (typeof initStudentPage === 'function') {
            initStudentPage();
        } else {
            console.log('initStudentPage not available on this page');
        }
    }, 100);
}
if (pageUrl.includes("admin-management.html")) {
    setTimeout(() => {
        if (typeof initAdminManagement === 'function') {
            initAdminManagement();
        } else {
            console.log('initAdminManagement not available on this page');
        }
    }, 100);
}

if (pageUrl.includes("teacher.html")) {
    setTimeout(() => {
        if (typeof initTeacherPage === 'function') {
            initTeacherPage();
        } else {
            console.log('initTeacherPage not available on this page');
        }
    }, 100);
}

// SPECIAL HANDLING FOR SESSION DETAILS
if (pageUrl.includes("session-details.html")) {
    const urlParams = new URLSearchParams(pageUrl.split('?')[1] || '');
    const sessionId = urlParams.get('id');
    
    if (sessionId) {
        setTimeout(() => {
            // First try loadSessionDetails
            if (typeof loadSessionDetails === 'function') {
                loadSessionDetails(sessionId);
            } 
            // Then try initSessionDetails
            else if (typeof initSessionDetails === 'function') {
                initSessionDetails();
            }
            else {
                console.error('No session details functions found');
                // Try to fetch and display manually
                fetch(`/api/session-plans/${sessionId}`)
                    .then(res => res.json())
                    .then(data => {
                        console.log('Manual fetch:', data);
                        // Basic display
                        document.getElementById('courseTitle').textContent = data.course || 'No Course';
                        document.getElementById('sessionId').textContent = data.id || 'N/A';
                    });
            }
        }, 200);
    }
}
            
            initModals();
        })
        .catch(err => {
            console.error('Error loading page:', err);
            area.innerHTML = `<h3 class='text-danger'>Error loading page</h3>`;
        });
}

window.onload = function () {
    loadPage('/pages/dashboard-content.html');
};

function toggleSidebar() {
    document.getElementById("sidebar").classList.toggle("collapsed");
}

/* -------------------------------------
   UNIVERSAL MODAL SYSTEM (Student + Teacher + viewparameter+ sessionadd)
-------------------------------------- */

let modalListenerAdded = false;

function initModals() {

    const studentPanel = document.getElementById("studentPanel");
    const teacherPanel = document.getElementById("teacherPanel");
    const viewparaPanel = document.getElementById("viewparaPanel");
    const sessionModal = document.getElementById("sessionModal");
    const settingsModal = document.getElementById("settingsModal");
    const programModal = document.getElementById("programModal");
    const semesterModal = document.getElementById("semesterModal");
    const courseModal = document.getElementById("courseModal");
 

    
 



    // If neither modal exists on page, do nothing
    if (!studentPanel && !teacherPanel && !viewparaPanel && !sessionModal && !settingsModal && !programModal && !semesterModal && !courseModal) return;

    // Add only ONE click listener for all pages
    if (!modalListenerAdded) {
        document.body.addEventListener("click", modalHandler);
        modalListenerAdded = true;
    }
}

function modalHandler(e) {

    const studentPanel = document.getElementById("studentPanel");
    const teacherPanel = document.getElementById("teacherPanel");
    const viewparaPanel = document.getElementById("viewparaPanel");
    const sessionModal = document.getElementById("sessionModal");
    const settingsModal = document.getElementById("settingsModal");
    const programModal = document.getElementById("programModal");
    const semesterModal = document.getElementById("semesterModal");
    const courseModal = document.getElementById("courseModal");
 



    



    /* ----------------------------
       OPEN MODALS
    ---------------------------- */

    // Student
    if (e.target.closest(".student-add-btn") && studentPanel) {
        studentPanel.classList.add("show");
    }

    // Teacher
    if (e.target.closest(".teacher-add-btn") && teacherPanel) {
        teacherPanel.classList.add("show");
    }
    // addparameter
    if (e.target.closest(".viewpara") ) {
        viewparaPanel.classList.add("show");
    }
    //addsession
    if (e.target.closest(".addsession") ) {
        sessionModal.classList.add("show");
    }
    // Settings
if (e.target.closest("#settingsLink") && settingsModal) {
    e.preventDefault();
    settingsModal.classList.add("show");
}
//addprogram
if (e.target.closest(".programAdd") ) {
        programModal.classList.add("show");
    }
    //addsemester
    if (e.target.closest(".semesterAdd") ) {
        semesterModal.classList.add("show");
    }
    //addcourse
     if (e.target.closest(".courseAdd") ) {
        courseModal.classList.add("show");
    }
    

    /* ----------------------------
       CLOSE MODALS
    ---------------------------- */

    if (e.target.closest(".modal-close")) {
        if (studentPanel) studentPanel.classList.remove("show");
        if (teacherPanel) teacherPanel.classList.remove("show");
        if (viewparaPanel) viewparaPanel.classList.remove("show");
        if (sessionModal) sessionModal.classList.remove("show");
        if (settingsModal) settingsModal.classList.remove("show");
        if (programModal) programModal.classList.remove("show");
        if (semesterModal) semesterModal.classList.remove("show");
        if (courseModal) courseModal.classList.remove("show");
 




    }

    // Click outside modal
    if (e.target === studentPanel) studentPanel.classList.remove("show");
    if (e.target === teacherPanel) teacherPanel.classList.remove("show");
    if (e.target === viewparaPanel) viewparaPanel.classList.remove("show");
    if (e.target === sessionModal) sessionModal.classList.remove("show");
    if (e.target === settingsModal) settingsModal.classList.remove("show");
    if (e.target === programModal) programModal.classList.remove("show");
    if (e.target === semesterModal) semesterModal.classList.remove("show");
     if (e.target === courseModal) courseModal.classList.remove("show");
 




}

// In your dashboard.js
document.addEventListener('DOMContentLoaded', function() {
    // Your dashboard initialization code here
    
    // Check if elements exist before adding listeners
    const element = document.getElementById('someElementId');
    if (element) {
        element.addEventListener('click', function() {
            // your code
        });
    }
    
    // OR use optional chaining
    document.getElementById('someElementId')?.addEventListener('click', function() {
        // your code
    });
});
</script>
<!--searchteacher-->
<script>
 const searchInput = document.getElementById('teacherSearch');
const filterSelect = document.getElementById('teacherFilter');
const table = document.querySelector('.teacher-table tbody');

searchInput.addEventListener('keyup', filterTable);
filterSelect.addEventListener('change', filterTable);

function filterTable() {
    const filterValue = searchInput.value.toLowerCase();
    const filterColumn = filterSelect.value;
    const rows = table.querySelectorAll('tr');

    rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        let text = '';

        if (filterColumn === 'all') {
            text = Array.from(cells).map(cell => cell.textContent.toLowerCase()).join(' ');
        } else if (filterColumn === 'name') {
            text = cells[0].textContent.toLowerCase();
        } else if (filterColumn === 'email') {
            text = cells[1].textContent.toLowerCase();
        } else if (filterColumn === 'department') {
            text = cells[2].textContent.toLowerCase();
        } else if (filterColumn === 'status') {
            text = cells[3].textContent.toLowerCase();
        }

        row.style.display = text.includes(filterValue) ? '' : 'none';
    });
}
</script>
<!--plansession-->
<script src="js/sessionplan.js"></script>
<script src="js/student.js"></script>
<script src="js/teacher.js"></script>
<script src="/js/session-details.js"></script>
<script src="/js/admin-management.js"></script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="/js/topbar.js"></script>

</body>
</html>
